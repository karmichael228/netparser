# NetParser

## Описание
NetParser — это мощный инструмент для анализа сетевого трафика, который позволяет анализировать PCAP-файлы и извлекать подробную информацию о сетевых соединениях. Инструмент поддерживает анализ DNS-запросов, SNI-записей, HTTP-трафика и автоматическое определение ASN для IP-адресов.

### Основные возможности
- Анализ DNS-запросов и ответов
- Извлечение SNI из TLS-соединений
- Анализ HTTP-трафика и запросов
- Определение ASN для IP-адресов
- Сравнение двух PCAP-файлов
- Генерация отчетов в различных форматах (JSON, HTML, TXT)
- Фильтрация пакетов по типу
- Проверка IP-адресов на наличие в черных списках (на основе репозитория [ipsum](https://github.com/stamparm/ipsum))

## Требования
- Python 3.6 или выше
- pip (менеджер пакетов Python)

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/karmichael228/netparser.git
cd netparser
```

2. Создайте виртуальное окружение:
```bash
python3 -m venv venv
source venv/bin/activate  # для Linux/MacOS
# или
venv\Scripts\activate  # для Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Структура проекта
```
netparser/
├── main.py              # Основной скрипт для запуска анализа
├── netparser.py         # Основной класс для анализа сетевого трафика
├── utils.py            # Вспомогательные функции для генерации отчетов
├── requirements.txt    # Зависимости проекта
└── README.md          # Документация проекта
```

## Использование

### Базовый анализ PCAP-файла
```bash
python3 main.py your_pcap_file.pcap
```

### Сравнение двух PCAP-файлов
```bash
python3 main.py base_pcap.pcap --compare plugin_pcap.pcap
```

### Генерация отчетов

#### JSON-отчет
```bash
python3 main.py your_pcap_file.pcap --json report.json
```

#### HTML-отчет
```bash
python3 main.py your_pcap_file.pcap --html report.html
```

#### TXT-отчет
```bash
python3 main.py your_pcap_file.pcap --txt report.txt
```

### Фильтрация пакетов
```bash
python3 main.py your_pcap_file.pcap --filter DNS,HTTP
```

### Проверка IP в черных списках
По умолчанию проверка IP-адресов в черных списках включена. Вы можете отключить эту функцию:

```bash
python3 main.py your_pcap_file.pcap --no-check-blacklists
```

Или явно включить:

```bash
python3 main.py your_pcap_file.pcap --check-blacklists
```

## Форматы отчетов

### JSON-отчет
Содержит структурированные данные о:
- DNS-запросах и ответах
- SNI-записях
- HTTP-запросах
- Статистике трафика
- ASN-информации
- наличии IP в черных списках

### HTML-отчет
Включает:
- Интерактивные таблицы
- Визуализацию данных
- Стилизованный интерфейс
- Ссылки на HTTP-ресурсы
- Цветовое выделение IP-адресов (зеленым - безопасные, красным - из черных списков)
- Индикаторы уровня угрозы для IP-адресов из черных списков

### TXT-отчет
Предоставляет:
- Простой текстовый формат
- Базовую информацию о соединениях
- DNS и SNI записи
- Информацию о наличии IP в черных списках

IP: 1.2.3.4
DNS Associations:
  - example.com
SNI Records:
  - example.com

### Консольный вывод
=== Общая статистика пакетов ===
[таблица со статистикой]

=== Статистика по IP ===
Всего IP: 42
IP в черном списке: 5

## Обработка ошибок
- Все ошибки логируются в файл `error.log`
- Программа предоставляет информативные сообщения об ошибках
- Поддерживается обработка некорректных PCAP-файлов

## Черные списки IP
Программа использует репозиторий [ipsum](https://github.com/stamparm/ipsum) для получения актуальной информации о подозрительных и вредоносных IP-адресах. Список обновляется ежедневно и кэшируется локально для повышения производительности.

Уровни угрозы определяются на основе количества черных списков, в которых встречается IP-адрес:
- **Низкий**: 1-2 списка
- **Средний**: 3-4 списка
- **Высокий**: 5-6 списков
- **Критический**: 7+ списков